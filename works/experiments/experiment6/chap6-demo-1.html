<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>实验六 - 交互式物体对象展示</title>
    <style>
        body { font-family: sans-serif; display: flex; }
        canvas { border: 1px solid black; }
        #controls { padding: 10px; display: flex; flex-direction: column; gap: 10px; }
        .control-group { border: 1px solid #ccc; padding: 10px; border-radius: 5px; }
        .control-group h3 { margin-top: 0; }
        label { display: block; margin-top: 5px; }
    </style>
</head>
<body>
    <canvas id="webgl-canvas" width="600" height="600">
        请使用支持WebGL的浏览器
    </canvas>

    <div id="controls">
        <div class="control-group">
            <h3>绘制控制</h3>
            <label>绘制模式:
                <select id="draw-mode">
                    <option value="solid">面片模式 (Solid)</option>
                    <option value="wireframe">线框模式 (Wireframe)</option>
                </select>
            </label>
            <label>面片颜色: <input type="color" id="solid-color" value="#888888"></label>
            <label>线框颜色: <input type="color" id="wireframe-color" value="#FFFFFF"></label>
        </div>

        <div class="control-group">
            <h3>成像控制 (P)</h3>
            <label>投影方式:
                <select id="projection-mode">
                    <option value="perspective">透视投影 (Perspective)</option>
                    <option value="ortho">正交投影 (Orthographic)</option>
                </select>
            </label>
            <div id="perspective-controls">
                <label>FovY (deg): <input type="range" id="persp-fovy" min="10" max="120" value="45"></label>
            </div>
            <div id="ortho-controls" style="display: none;">
                <label>Ortho Scale: <input type="range" id="ortho-scale" min="1" max="20" value="5"></label>
            </div>
             <label>Near: <input type="range" id="proj-near" min="0.1" max="50" value="0.1" step="0.1"></label>
             <label>Far: <input type="range" id="proj-far" min="1" max="200" value="100"></label>
        </div>

        <div class="control-group">
            <h3>模型变换 (M)</h3>
            <label>平移 Y: <input type="range" id="model-ty" min="-5" max="5" value="-1.5" step="0.1"></label>
            <label>旋转 Y: <input type="range" id="model-ry" min="-180" max="180" value="0"></label>
            <label>缩放: <input type="range" id="model-scale" min="0.1" max="5" value="1" step="0.1"></label>
        </div>
    </div>

    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 a_Position;
        attribute vec4 a_Normal;

        uniform mat4 u_MVP;
        uniform mat4 u_NormalMatrix; // 模型矩阵的逆转置矩阵

        varying vec3 v_Normal;
        varying vec3 v_Position;

        void main() {
            gl_Position = u_MVP * a_Position;
            
            // 计算变换后的法线和顶点位置 (用于片元着色器中的光照)
            v_Normal = normalize(vec3(u_NormalMatrix * a_Normal));
            v_Position = vec3(gl_Position); // 在视图空间中的位置
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;

        uniform vec4 u_Color;
        uniform vec3 u_LightDir; // 归一化的光照方向

        varying vec3 v_Normal;
        varying vec3 v_Position;

        void main() {
            // 简单的漫反射光照 (Lambert)
            vec3 normal = normalize(v_Normal);
            float nDotL = max(dot(normal, u_LightDir), 0.0);
            
            // 基础环境光 + 漫反射
            vec3 ambient = 0.2 * u_Color.rgb;
            vec3 diffuse = nDotL * u_Color.rgb;

            gl_FragColor = vec4(ambient + diffuse, u_Color.a);
        }
    </script>

    <script src="../../lib/webgl-utils.js"></script>
    <script src="../../lib/initShaders.js"></script>
    <script src="../../lib/gl-matrix-min.js"></script>

    <script src="chap6-demo-1.js"></script>

</body>
</html>